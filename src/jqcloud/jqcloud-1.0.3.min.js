/*
 * jQCloud Plugin for jQuery
 *
 * Version 1.0.3
 *
 * Copyright 2011, Luca Ongaro
 * Licensed under the MIT license.
 *
 * Date: 2013-02-17 17:57:00 +0100
*/
(function(a){a.fn.jQCloud=function(c,d){function g(){return 0.5}var f=this;var e=f.attr("id")||Math.floor((Math.random()*1000000)).toString(36);var h={width:f.width(),height:f.height(),center:{x:((d&&d.width)?d.width:f.width())/2,y:((d&&d.height)?d.height:f.height())/2},delayedMode:c.length>50,shape:false,encodeURI:true};d=a.extend(h,d||{});f.addClass("jqcloud").width(d.width).height(d.height);if(f.css("position")==="static"){f.css("position","relative")}var b=function(){var k=function(t,r){var q=function(u,i){if(Math.abs(2*u.offsetLeft+u.offsetWidth-2*i.offsetLeft-i.offsetWidth)<u.offsetWidth+i.offsetWidth){if(Math.abs(2*u.offsetTop+u.offsetHeight-2*i.offsetTop-i.offsetHeight)<u.offsetHeight+i.offsetHeight){return true}}return false};var s=0;for(s=0;s<r.length;s++){if(q(t,r[s])){return true}}return false};for(var l=0;l<c.length;l++){c[l].weight=parseFloat(c[l].weight,10)}c.sort(function(q,i){if(q.weight<i.weight){return 1}else{if(q.weight>i.weight){return -1}else{return 0}}});var o=(d.shape==="rectangular")?18:2,j=[],m=d.width/d.height;var n=function(s,B){var E=e+"_word_"+s,t="#"+E,C=6.28*g(),q=0,u=0,G=0,w=5,A="",D="",v;B.html=a.extend(B.html,{id:E});if(B.html&&B.html["class"]){A=B.html["class"];delete B.html["class"]}if(c[0].weight>c[c.length-1].weight){w=Math.round((B.weight-c[c.length-1].weight)/(c[0].weight-c[c.length-1].weight)*9)+1}v=a("<span>").attr(B.html).addClass("w"+w+" "+A);if(B.link){if(typeof B.link==="string"){B.link={href:B.link}}if(d.encodeURI){B.link=a.extend(B.link,{href:encodeURI(B.link.href).replace(/'/g,"%27")})}D=a("<a>").attr(B.link).text(B.text)}else{D=B.text}v.append(D);if(!!B.handlers){for(var i in B.handlers){if(B.handlers.hasOwnProperty(i)&&typeof B.handlers[i]==="function"){a(v).bind(i,B.handlers[i])}}}f.append(v);var z=v.width(),y=v.height(),r=d.center.x-z/2,x=d.center.y-y/2;var F=v[0].style;F.position="absolute";F.left=r+"px";F.top=x+"px";while(k(v[0],j)){if(d.shape==="rectangular"){u++;if(u*o>(1+Math.floor(G/2))*o*((G%4%2)===0?1:m)){u=0;G++}switch(G%4){case 1:r+=o*m+g()*2;break;case 2:x-=o+g()*2;break;case 3:r-=o*m+g()*2;break;case 0:x+=o+g()*2;break}}else{q+=o;C+=(s%2===0?1:-1)*o;r=d.center.x-(z/2)+(q*Math.cos(C))*m;x=d.center.y+q*Math.sin(C)-(y/2)}F.left=r+"px";F.top=x+"px"}j.push(v[0]);if(a.isFunction(B.afterWordRender)){B.afterWordRender.call(v)}};var p=function(i){i=i||0;if(!f.is(":visible")){setTimeout(function(){p(i)},10);return}if(i<c.length){n(i,c[i]);setTimeout(function(){p(i+1)},10)}else{if(a.isFunction(d.afterCloudRender)){d.afterCloudRender.call(f)}}};if(d.delayedMode){p()}else{a.each(c,n);if(a.isFunction(d.afterCloudRender)){d.afterCloudRender.call(f)}}};setTimeout(function(){b()},10);return f}})(jQuery);